<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{front/layouts/main}">
<main layout:fragment="content">
    <section>
        <div class="main_banner1">
            <img th:src="@{/common/images/main_banner1.png}" alt="banner1" class="main_banner_img1">
        </div>
    </section>
    <section>
        <h1>새로 올라온 책</h1>
        <div class="main_prd">
            <form id="frmList" name="frmList" method="post" th:action="@{/front/main}" target="ifrmProcess" autocomplete="off">
                <th:block th:if="${items != null && items.size() > 0}">
                        <div class="book-pagination">
                            <button id="prevPage" class="page-button" style="display: none; transform: rotate(180deg);"></button>
                            <ul class="main_prd_ul">
                                <!--메인 화면 상품 리스트에는 '판매중' 인 상품만 진열-->
                                <li th:each="item, status : ${items}" th:object="${item}" class="main_prd_li" th:if="${item.status.toString().equals('SALE')}">
                                        <a>
                                        <div>
                                            <span class="main_img_box">
                                                <img class="main_prd_img" alt="메인 상품 이미지" th:src="@{/common/images/test_img.jpg}">
                                            </span>
                                        </div>
                                        <div class="main_book_info_box">
                                            <p class="main_bookNm" th:text="*{bookNm}"></p>
                                            <p class="main_auth_pub">
                                                <span class="main_author" th:text="*{author}"></span>
                                                <em class="divi"></em>
                                                <span class="main_pub" th:text="*{publisher}"></span>
                                            </p>
                                            <p class="main_price_box">
                                                <span class="main_price" th:if="*{price >= 1000}" th:text="*{#numbers.formatInteger(price, 3, 'COMMA') + '원'}"></span>
                                                <span class="main_price" th:unless="*{price >= 1000}" th:text="*{price + '원'}"></span>
                                            </p>
                                        </div>
                                    </a>
                                </li>
                            </ul>
                            <button id="nextPage" class="page-button" style="margin-left: 36px;"></button>
                        </div>
                    <!--</th:block>-->
                    <!--</th:block>-->
                </th:block>
                <th:block th:unless="${items != null && items.size() > 0}">
                    <h3>조회된 목록이 없습니다.</h3>
                </th:block>

            </form>
        </div>
    </section>

    <script>
        const itemsPerPage = 6;
        const items = document.querySelectorAll('.main_prd_li');
        const prevButton = document.getElementById('prevPage');
        const nextButton = document.getElementById('nextPage');
        const noResultsMessage = document.querySelector('.no-results');
        let currentPage = 1;

        function showPage(page) {
            for (let i = 0; i < items.length; i++) {
                items[i].style.display = 'none';
            }
            for (let i = (page - 1) * itemsPerPage; i < page * itemsPerPage; i++) {
                if (items[i]) {
                    items[i].style.display = 'block';
                }
            }
        }

        function updatePaginationButtons() {
            if (currentPage === 1) {
                prevButton.style.display = 'none';
            } else {
                prevButton.style.display = 'block';
            }
            if (currentPage * itemsPerPage >= items.length) {
                nextButton.style.display = 'none';
            } else {
                nextButton.style.display = 'block';
            }
        }

        function checkResults() {
            if (items.length === 0) {
                noResultsMessage.style.display = 'block';
            } else {
                noResultsMessage.style.display = 'none';
            }
        }

        prevButton.addEventListener('click', () => {
            if (currentPage > 1) {
                currentPage--;
                showPage(currentPage);
                updatePaginationButtons();
            }
        });

        nextButton.addEventListener('click', () => {
            if (currentPage * itemsPerPage < items.length) {
                currentPage++;
                showPage(currentPage);
                updatePaginationButtons();
            }
        });

        showPage(currentPage);
        updatePaginationButtons();
        checkResults();
    </script>

</main>
</html>